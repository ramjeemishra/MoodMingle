<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodMingle</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();

            const username = prompt('Enter your username:');
            socket.emit('set username', username);

            const moodForm = document.getElementById('mood-form');
            const messageForm = document.getElementById('message-form');
            const messages = document.getElementById('messages');
            const customMoodButton = document.getElementById('custom-mood-button');
            const customMoodInput = document.getElementById('custom-mood-input');
            const predefinedMoods = document.querySelectorAll('.predefined-mood');
            const selectedMoodDisplay = document.getElementById('selected-mood');
            const totalUsersDisplay = document.getElementById('total-users');
            const moodCountsDisplay = document.getElementById('mood-counts');
            const moodStatsDisplay = document.getElementById('mood-stats');

            let matchedGroup = null;
            let currentMood = null;

            predefinedMoods.forEach(button => {
                button.addEventListener('click', () => {
                    const mood = button.innerText;
                    if (mood === currentMood) {
                        alert(`You are already in the mood: ${mood}.`);
                    } else {
                        if (currentMood) {
                            alert(`You have selected a mood before: ${currentMood}. Please clear your previous mood first.`);
                        } else {
                            socket.emit('enter mood', mood);
                            currentMood = mood;
                            selectedMoodDisplay.innerText = `Your selected mood is: ${mood}`;
                        }
                    }
                });
            });

            customMoodButton.addEventListener('click', () => {
                customMoodInput.style.display = 'block';
            });

            moodForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const mood = "Private";
                if (mood === currentMood) {
                    alert(`You are already in the mood: ${mood}.`);
                } else {
                    if (currentMood) {
                        alert(`You have selected a mood before: ${currentMood}. Please clear your previous mood first.`);
                    } else {
                        socket.emit('enter mood', mood);
                        currentMood = mood;
                        selectedMoodDisplay.innerText = `Your selected mood is: ${mood}`;
                    }
                }
            });

            socket.on('matched', ({ group }) => {
                matchedGroup = group;
                alert('Matched in group: ' + group);
            });

            messageForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const messageInput = document.getElementById('message');
                const message = messageInput.value;
                if (matchedGroup) {
                    socket.emit('send message', { message });
                    const newMessageElement = document.createElement('li');
                    newMessageElement.classList.add('message');
                    newMessageElement.innerHTML = `<strong>You:</strong> ${message}`;
                    messages.insertBefore(newMessageElement, messages.firstChild);
                    messageInput.value = '';
                }
            });

            socket.on('receive message', ({ from, message }) => {
                const newMessageElement = document.createElement('li');
                newMessageElement.classList.add('message');
                newMessageElement.innerHTML = `<strong>${from}:</strong> ${message}`;
                messages.insertBefore(newMessageElement, messages.firstChild);
            });

            socket.on('user counts', ({ totalUsers, moodCounts }) => {
                totalUsersDisplay.innerText = `Total users: ${totalUsers}`;
                moodStatsDisplay.innerHTML = ''; // Clear previous data
                for (const mood in moodCounts) {
                    const moodElement = document.createElement('p');
                    moodElement.innerText = `${mood} users: ${moodCounts[mood]}`;
                    moodStatsDisplay.appendChild(moodElement);
                }
            });

            socket.on('user left', () => {
                alert('Your chat partner has left.');
                matchedGroup = null;
                selectedMoodDisplay.innerText = 'You are not currently in a chat.';
            });
        });
    </script>
</head>

<body>

    <div class="made-with-love">
        Made with <i id="heart">ðŸ’–</i>&amp;<i id="coffee">â˜•</i> by
        <a href="https://ramjeemishra.github.io/Ramjee_Mishra/">Developer Ram</a>
      </div>
    <div class="container">
        <h1>MoodMingle</h1>
        <p id="selected-mood"></p> <!-- Placeholder for selected mood -->
        <p id="total-users"></p> <!-- Placeholder for total users -->
        <p id="mood-counts"></p> <!-- Placeholder for mood counts -->
        <div id="mood-stats">
            <h2>Users by Mood</h2>
        </div>
        <div id="mood-selection">
            <button class="predefined-mood">Happy</button>
            <button class="predefined-mood">Sad</button>
            <button class="predefined-mood">Angry</button>
            <button class="predefined-mood">Excited</button>
            <button class="predefined-mood">Anxious</button>
            <button id="custom-mood-button">Create Room</button>
        </div>
        <form id="mood-form" class="form">
            <input type="text" id="custom-mood-input" placeholder="Password here {strong}" required>
            <button type="submit">Submit</button>
        </form>
        <form id="message-form" class="form">
            <input type="text" id="message" placeholder="Enter your message" required>
            <button type="submit">Send</button>
        </form>
        <ul id="messages" class="messages"></ul>
    </div>
</body>

</html>